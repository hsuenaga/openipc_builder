################################################################################
#
# linux-patcher
#
################################################################################

LINUX_PATCHER_DEPENDENCIES = linux
export UIMAGE_NAME = Linux-$(LINUX_VERSION_PROBED)-$(OPENIPC_SOC_MODEL)

# Exclude buildroot yylloc patches
LINUX_POST_PATCH_HOOKS = LINUX_APPLY_LOCAL_PATCHES

ifeq ($(BR2_PACKAGE_LINUX_PATCHER_ATHEROS),y)
define LINUX_PATCHER_CONFIG_ATHEROS
	$(call KCONFIG_ENABLE_OPT,CONFIG_FW_LOADER)
	$(call KCONFIG_ENABLE_OPT,CONFIG_WLAN)
	$(call KCONFIG_SET_OPT,CONFIG_MAC80211,m)
	$(call KCONFIG_SET_OPT,CONFIG_ATH9K,m)
	$(call KCONFIG_SET_OPT,CONFIG_ATH9K_HTC,m)
endef
endif

ifneq ($(BR2_PACKAGE_LINUX_PATCHER_SIGMASTAR_DTB),"")
define LINUX_PATCHER_CONFIG_SIGMASTAR_DTB
	$(call KCONFIG_SET_OPT,CONFIG_SS_DTB_NAME,$(BR2_PACKAGE_LINUX_PATCHER_SIGMASTAR_DTB))
endef
endif

ifeq ($(BR2_PACKAGE_LINUX_PATCHER_RTW88),y)
define LINUX_PATCHER_CONFIG_RTW88
	$(call KCONFIG_DISABLE_OPT,CONFIG_CFG80211_CRDA_SUPPORT)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CFG80211_DEFAULT_PS)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CFG80211)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CFG80211_WEXT)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_ARC4)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_DEFLATE)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_DES)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_ECHAINIV)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_LZ4)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_MD4)
	$(call KCONFIG_DISABLE_OPT,CONFIG_CRYPTO_MD5)
	$(call KCONFIG_DISABLE_OPT,CONFIG_LZ4_COMPRESS)
	$(call KCONFIG_DISABLE_OPT,CONFIG_WEXT_CORE)
	$(call KCONFIG_DISABLE_OPT,CONFIG_WEXT_PRIV)
	$(call KCONFIG_DISABLE_OPT,CONFIG_WEXT_PROC)
	$(call KCONFIG_DISABLE_OPT,CONFIG_WIRELESS_EXT)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_BPAUTO_BUILD_CRYPTO_LIB_ARC4)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_BPAUTO_CRYPTO_LIB_ARC4)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_BP_MODULES)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_CFG80211_CRDA_SUPPORT)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_CFG80211,m)
	$(call KCONFIG_ENABLE_OPT,+CONFIG_BACKPORT_CFG80211_WEXT)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_DIR,"backports/")
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_INTEGRATE)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_10)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_11)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_12)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_13)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_14)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_15)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_16)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_17)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_18)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_19)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_20)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_21)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_22)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_23)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_24)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_25)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_26)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_27)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_28)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_29)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_30)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_31)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_32)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_33)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_34)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_35)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_36)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_37)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_38)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_39)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_40)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_41)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_42)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_43)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_44)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_45)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_46)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_47)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_48)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_49)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_50)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_51)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_52)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_53)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_54)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_55)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_56)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_57)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_58)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_59)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_60)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_61)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_62)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_63)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_64)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_65)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_66)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_67)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_68)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_69)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_70)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_71)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_72)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_73)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_74)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_75)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_76)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_77)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_78)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_79)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_80)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_81)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_82)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_83)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_84)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_85)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_86)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_87)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_88)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_89)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_90)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_91)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_92)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_93)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_94)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_95)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_96)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_97)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_4_98)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_10)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_11)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_13)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_15)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_2)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_3)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_4)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_KERNEL_5_5)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_KERNEL_NAME,"Linux")
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_KERNEL_VERSION,"v5.15.162-0-gf45bea23c39c")
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_LINUX)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_MAC80211_HAS_RC)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_MAC80211_LEDS)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_MAC80214,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_MAC80213_RC_DEFAULT,"minstrel_ht")
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_MAC80211_RC_DEFAULT_MINSTREL)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_MAC80211_RC_MINSTREL)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_MAC80211_STA_HASH_MAX_SIZE,0)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_NL80211_TESTMODE)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8812A,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8812AU,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8821A,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8821AU,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8821C,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8821CU,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8822B,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_8822BU,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_88XXA,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_CORE,m)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_RTW88_LEDS)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_RTW88_USB,m)
	$(call KCONFIG_SET_OPT,CONFIG_BACKPORT_VERSION,"v5.15.162-1-0-g9fa1c65c")
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_WEXT_CORE)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_WEXT_PRIV)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_WEXT_PROC)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_WIRELESS_EXT)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_WLAN_VENDOR_REALTEK)
	$(call KCONFIG_ENABLE_OPT,CONFIG_BACKPORT_WLAN)
	$(call KCONFIG_ENABLE_OPT,CONFIG_CRYPTO_CCM)
	$(call KCONFIG_ENABLE_OPT,CONFIG_CRYPTO_CRC32)
	$(call KCONFIG_ENABLE_OPT,CONFIG_CRYPTO_GCM)
	$(call KCONFIG_ENABLE_OPT,CONFIG_CRYPTO_GF128MUL)
	$(call KCONFIG_ENABLE_OPT,CONFIG_CRYPTO_GHASH)
	$(call KCONFIG_ENABLE_OPT,CONFIG_FW_LOADER)
	$(call KCONFIG_SET_OPT,CONFIG_LEDS_CLASS,m)
	$(call KCONFIG_ENABLE_OPT,CONFIG_LEDS_TRIGGERS)
	$(call KCONFIG_ENABLE_OPT,CONFIG_NEW_LEDS)
	$(call KCONFIG_ENABLE_OPT,CONFIG_RFKILL_LEDS)
	$(call KCONFIG_ENABLE_OPT,CONFIG_WANT_DEV_COREDUMP)
endef
endif

define LINUX_PATCHER_LINUX_CONFIG_FIXUPS
	$(LINUX_PATCHER_CONFIG_ATHEROS)
	$(LINUX_PATCHER_CONFIG_SIGMASTAR_DTB)
	$(LINUX_PATCHER_CONFIG_RTW88)
endef

$(eval $(generic-package))
